# Warehouse
warehouse = {}
# Transaction history
actions = []
# Initialize balance
balance = 0

# Function to save data to text file
def save_data():
    with open("data.txt", "a") as file:
        file.write("Saldo konta: " + str(balance) + "\n")
        file.write("Stan magazynu:\n")
        for product, details in warehouse.items():
            file.write(f"Produkt: {product}, Cena: {details['price']}, Ilość: {details['quantity']}\n")
        file.write("Historia operacji:\n")
        for action in actions:
            file.write(str(action) + "\n")

# Function to load data from text file
def load_data():
    global balance
    global warehouse
    global actions

    warehouse = {}
    actions = []

    try:
        with open("data.txt", "r") as file:
            lines = file.readlines()
            balance = float(lines[0].split(":")[1].strip())

            for line in lines[1:]:
                if line.startswith("Produkt"):
                    parts = line.strip().split(", ")
                    name = parts[0].split(": ")[1]
                    price = float(parts[1].split(": ")[1])
                    quantity = int(parts[2].split(": ")[1])
                    warehouse[name] = {'price': price, 'quantity': quantity}
                elif line.startswith("("):
                    action = eval(line.strip())  # Using eval() to convert string representation of tuple to actual tuple
                    actions.append(action)
    except FileNotFoundError:
        print("Plik danych nie istnieje. Tworzenie nowego pliku.")

# Load data if available
load_data()

# Main loop
while True:
    print("\nDostępne komendy: saldo, sprzedaż, zakup, konto, lista, magazyn, przegląd, koniec")
    command = input("Podaj komendę: ").lower()

    # Command execution
    if command == 'saldo':
        amount = float(input("Podaj kwotę do dodania lub odjęcia z konta: "))
        balance += amount
        actions.append(('saldo', amount))
        save_data()
    elif command == 'sprzedaż':
        name = input("Podaj nazwę produktu: ")
        if name not in warehouse:
            print("Produkt nie istnieje w magazynie!")
            continue

        price = float(input("Podaj cenę produktu: "))
        quantity = int(input("Podaj liczbę sztuk: "))
        product = warehouse[name]
        if product['quantity'] < quantity:
            print("Brak wystarczającej liczby sztuk w magazynie!")
            continue

        total_price = price * quantity
        product['quantity'] -= quantity
        balance += total_price
        actions.append(('sprzedaż', name, price, quantity))
        save_data()
    elif command == 'zakup':
        name = input("Podaj nazwę produktu: ")
        price = float(input("Podaj cenę produktu: "))
        if price < 0:
            print("Nie można wykonać operacji")
            continue
        quantity = int(input("Podaj liczbę sztuk: "))

        if price * quantity > balance:
            print("Brak wystarczających środków na koncie!")
            continue

        if name in warehouse:
            warehouse[name]['quantity'] += quantity
        else:
            warehouse[name] = {'price': price, 'quantity': quantity}

        total_price = price * quantity
        balance -= total_price
        actions.append(('zakup', name, price, quantity))
        save_data()
    elif command == 'konto':
        print("Stan konta: ", balance)
    elif command == 'lista':
        print("Stan magazynu:")
        for product, details in warehouse.items():
            print(f"Produkt: {product}, Cena: {details['price']}, Ilość: {details['quantity']}")
    elif command == 'magazyn':
        name = input("Podaj nazwę produktu: ")
        product = warehouse.get(name)
        if product:
            print(f"Stan magazynu dla produktu {name}: Cena: {product['price']}, Ilość: {product['quantity']}")
        else:
            print("Produkt nie istnieje w magazynie!")
    elif command == 'przegląd':
        start = input("Podaj indeks początkowy (od 0) lub zostaw puste dla początku: ")
        end = input(f"Podaj indeks końcowy (max {len(actions)-1}) lub zostaw puste dla końca: ")

        try:
            if start == '':
                start = 0
            else:
                start = int(start)
            if end == '':
                end = len(actions) - 1
            else:
                end = int(end)

            if start < 0 or end >= len(actions):
                print(f"Podano nieprawidłowy zakres, dostępne indeksy od 0 do {len(actions)-1}")
                continue

            print("Historia operacji:")
            for i in range(start, end + 1):
                print(actions[i])
        except ValueError:
            print("Podano nieprawidłowy zakres!")
    elif command == 'koniec':
        print("Koniec działania programu.")
        break
    else:
        print("Nieprawidłowa komenda!")
